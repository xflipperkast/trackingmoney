<!DOCTYPE html>
<html lang="nl">
<head>
  <meta charset="UTF-8">
  <title>Geldzaken Overzicht</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    body { background-color: #121212; color: #fff; }
    .nav-tabs .nav-link.active { background-color: #333; color: #fff; }
    .table thead th { background-color: #222; }
    .negative { background-color: #ff3b3b33; }
    .positive { background-color: #4caf5033; }
    .modal-content { background-color: #1e1e1e; color: white; }
    .form-control, .form-select { background-color: #2c2c2c; color: white; border: 1px solid #555; }
  </style>
</head>
<body>
<div class="container py-4">
  <h1 class="mb-4">Geldzaken Overzicht</h1>

  <div class="mb-3">
    <input type="file" id="fileInput" accept=".json" class="form-control">
  </div>

  <ul class="nav nav-tabs" id="yearTabs"></ul>
  <ul class="nav nav-tabs mt-2" id="monthTabs"></ul>

  <div class="mt-4" id="transactionsContainer"></div>

  <div class="mt-3">
    <button class="btn btn-outline-info" data-bs-toggle="modal" data-bs-target="#accountsModal">üè¶ Rekeningen beheren</button>
    <button id="addTransaction" class="btn btn-outline-light" data-bs-toggle="modal" data-bs-target="#transactionModal">‚ûï Transactie toevoegen</button>
    <button id="downloadBtn" class="btn btn-success">Download JSON</button>
  </div>
</div>

<!-- Modal: Transactie -->
<div class="modal fade" id="transactionModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Nieuwe Transactie</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Sluiten"></button>
      </div>
      <div class="modal-body">
        <div class="mb-2">
          <label class="form-label">Datum</label>
          <input type="date" id="transDate" class="form-control">
        </div>
        <div class="mb-2">
          <label class="form-label">Omschrijving</label>
          <input type="text" id="transDesc" class="form-control">
        </div>
        <div class="mb-2">
          <label class="form-label">Bedrag</label>
          <input type="number" id="transAmount" class="form-control">
        </div>
        <div class="mb-2">
          <label class="form-label">Type</label>
          <select id="transType" class="form-select">
            <option value="inkomen">Inkomen</option>
            <option value="uitgave">Uitgave</option>
            <option value="boodschappen">Boodschappen</option>
            <option value="rekening">Rekening (gas/licht)</option>
          </select>
        </div>
        <div class="mb-2" id="incomeSubTypeWrapper" style="display: none;">
          <label class="form-label">Soort Inkomen</label>
          <select id="incomeSubType" class="form-select">
            <option value="salaris">Salaris</option>
            <option value="terugbetaling">Terugbetaling</option>
            <option value="uitkering">Uitkering</option>
            <option value="bijbaan">Bijbaan</option>
            <option value="overig">Overig</option>
          </select>
        </div>
        <div class="mb-2">
          <label class="form-label">Rekening</label>
          <select id="transAccount" class="form-select"></select>
        </div>
        <div class="form-check">
          <input class="form-check-input" type="checkbox" id="transRecurring">
          <label class="form-check-label">Automatische incasso</label>
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Annuleer</button>
        <button type="button" class="btn btn-primary" id="saveTransaction">Opslaan</button>
      </div>
    </div>
  </div>
</div>

<!-- Modal: Rekeningen -->
<div class="modal fade" id="accountsModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Rekeningen</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Sluiten"></button>
      </div>
      <div class="modal-body">
        <ul id="accountList" class="list-group mb-3"></ul>
        <div class="mb-2">
          <input type="text" id="newAccountName" class="form-control mb-2" placeholder="Naam (bijv. PayPal)">
          <input type="number" id="newAccountBalance" class="form-control mb-2" placeholder="Saldo (‚Ç¨)">
          <select id="newAccountType" class="form-select mb-2">
            <option value="bank">Bank</option>
            <option value="paypal">PayPal</option>
            <option value="crypto">Crypto</option>
            <option value="contant">Contant</option>
            <option value="gas">Gas</option>
            <option value="mobiel">Mobiel</option>
            <option value="internet_tv">Internet/TV</option>
            <option value="simkaart">Simkaart</option>
          </select>
          <button class="btn btn-outline-success" id="addAccount">Toevoegen</button>
        </div>
      </div>
    </div>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script>
  let rawData = {};
  let currentYear = null;
  let currentMonth = null;
  let accounts = {};

  function initializeTemplate() {
    const now = new Date();
    const year = now.getFullYear().toString();
    const month = now.toLocaleString('nl-NL', { month: 'long' });
    rawData = { [year]: { [month]: [] } };
    currentYear = year;
    currentMonth = month;
    renderYearTabs(); renderMonthTabs(); renderTransactions(); updateAccountList();
  }

  function renderYearTabs() {
    const container = document.getElementById('yearTabs'); container.innerHTML = '';
    Object.keys(rawData).sort((a,b)=>a-b).forEach(year => {
      const li = document.createElement('li'); li.className = 'nav-item';
      const btn = document.createElement('button');
      btn.className = 'nav-link' + (year===currentYear?' active':''); btn.textContent = year;
      btn.onclick = () => {
        currentYear = year;
        const months = Object.keys(rawData[year] || {});
        months.sort((a,b)=> new Date(`1 ${a}`)-new Date(`1 ${b}`));
        currentMonth = months[0] || month;
        renderYearTabs(); renderMonthTabs(); renderTransactions();
      };
      li.appendChild(btn); container.appendChild(li);
    });
  }

  function renderMonthTabs() {
    const container = document.getElementById('monthTabs'); container.innerHTML = '';
    if (!rawData[currentYear]) return;
    const months = Object.keys(rawData[currentYear]);
    const monthOrder = ["januari","februari","maart","april","mei","juni","juli","augustus","september","oktober","november","december"];
    months.sort((a,b)=> monthOrder.indexOf(a.toLowerCase())-monthOrder.indexOf(b.toLowerCase()));
    months.forEach(month => {
      const li = document.createElement('li'); li.className = 'nav-item';
      const btn = document.createElement('button');
      btn.className = 'nav-link' + (month===currentMonth?' active':''); btn.textContent = month;
      btn.onclick = () => { currentMonth = month; renderMonthTabs(); renderTransactions(); };
      li.appendChild(btn); container.appendChild(li);
    });
  }

  function renderTransactions() {
    const cont = document.getElementById('transactionsContainer'); cont.innerHTML = '';
    if (!rawData[currentYear] || !rawData[currentYear][currentMonth]) return;
    const table = document.createElement('table'); table.className = 'table table-dark table-bordered';
    const thead = document.createElement('thead'), headRow = document.createElement('tr');
    ['Datum','Omschrijving','Bedrag','Type','SubType','Rekening'].forEach(k=>{
      const th = document.createElement('th'); th.textContent = k; headRow.appendChild(th);
    }); thead.appendChild(headRow); table.appendChild(thead);
    const tbody = document.createElement('tbody');
    rawData[currentYear][currentMonth].forEach(row=>{
      const tr = document.createElement('tr'); tr.className = parseFloat(row.Bedrag)<0?'negative':'positive';
      ['Datum','Omschrijving','Bedrag','Type','SubType','Rekening'].forEach(k=>{
        const td = document.createElement('td'); td.textContent = row[k]||''; tr.appendChild(td);
      }); tbody.appendChild(tr);
    }); table.appendChild(tbody); cont.appendChild(table);
  }

  document.getElementById('transType').addEventListener('change',()=>{
    document.getElementById('incomeSubTypeWrapper').style.display =
      document.getElementById('transType').value === 'inkomen' ? 'block' : 'none';
  });

  document.getElementById('saveTransaction').addEventListener('click',()=>{
    const date = document.getElementById('transDate').value;
    const desc = document.getElementById('transDesc').value;
    const amount = parseFloat(document.getElementById('transAmount').value);
    const type = document.getElementById('transType').value;
    const subType = document.getElementById('incomeSubType').value;
    const account = document.getElementById('transAccount').value;
    const recurring = document.getElementById('transRecurring').checked;
    if (!date||!desc||isNaN(amount)) return alert('Vul alle velden correct in.');
    const d = new Date(date);
    const y = d.getFullYear().toString();
    const m = d.toLocaleString('nl-NL',{month:'long'});
    if (!rawData[y]) rawData[y] = {};
    if (!rawData[y][m]) rawData[y][m] = [];
    rawData[y][m].push({ Datum:date, Omschrijving:desc, Bedrag:amount, Type:type,
      SubType: type==='inkomen'? subType : null, Herhaal:recurring, Rekening:account });
    if (account && accounts[account]) {
      if (type==='inkomen') accounts[account].balance += amount;
      else accounts[account].balance -= amount;
      updateAccountList();
    }
    currentYear=y; currentMonth=m; renderYearTabs(); renderMonthTabs(); renderTransactions();
    document.querySelector('#transactionModal .btn-close').click();
  });

  function updateAccountList() {
    const list = document.getElementById('accountList'); list.innerHTML = '';
    Object.entries(accounts).forEach(([name,obj])=>{
      const li = document.createElement('li'); li.className='list-group-item bg-dark text-white d-flex justify-content-between align-items-center';
      const info = document.createElement('span');
      info.textContent = `${name} (‚Ç¨${obj.balance.toFixed(2)}) - ${obj.type}`;
      const del = document.createElement('button'); del.className='btn btn-sm btn-danger'; del.textContent='‚úñ';
      del.onclick = ()=>{ delete accounts[name]; updateAccountList(); };
      li.append(info, del); list.appendChild(li);
    }); updateAccountSelect();
  }

  function updateAccountSelect() {
    const sel = document.getElementById('transAccount'); sel.innerHTML = '';
    Object.keys(accounts).forEach(acc=>{
      const opt=document.createElement('option');
      opt.value=acc; opt.textContent=`${acc} (‚Ç¨${accounts[acc].balance.toFixed(2)})`;
      sel.appendChild(opt);
    });
  }

  document.getElementById('addAccount').addEventListener('click',()=>{
    const name = document.getElementById('newAccountName').value.trim();
    const balance = parseFloat(document.getElementById('newAccountBalance').value);
    const type = document.getElementById('newAccountType').value;
    if (!name||isNaN(balance)) return;
    accounts[name] = { balance, type };
    document.getElementById('newAccountName').value='';
    document.getElementById('newAccountBalance').value='';
    updateAccountList();
  });

  document.getElementById('fileInput').addEventListener('change',async e=>{
    const file=e.target.files[0]; if(!file) return;
    try {
      const txt = await file.text(); const parsed = JSON.parse(txt);
      rawData = parsed.data||parsed; accounts = parsed.accounts||{};
      Object.entries(accounts).forEach(([k,v])=>{ if(typeof v==='number') accounts[k]={balance:v,type:'onbekend'}; });
      currentYear=Object.keys(rawData)[0]; currentMonth=Object.keys(rawData[currentYear])[0];
      renderYearTabs(); renderMonthTabs(); renderTransactions(); updateAccountList();
    } catch { initializeTemplate(); }
  });

  document.getElementById('downloadBtn').addEventListener('click',()=>{
    const blob=new Blob([JSON.stringify({ data: rawData, accounts },null,2)],{type:'application/json'});
    const url=URL.createObjectURL(blob); const a=document.createElement('a'); a.href=url; a.download='geldzaken.json'; a.click(); URL.revokeObjectURL(url);
  });

  window.addEventListener('DOMContentLoaded', initializeTemplate);
</script>
</body>
</html>
